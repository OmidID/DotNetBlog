/*
 * Editor.md
 *
 * @file        editormd.js 
 * @version     v1.5.0 
 * @description Open source online markdown editor.
 * @license     MIT License
 * @author      Pandao
 * {@link       https://github.com/pandao/editor.md}
 * @updateTime  2015-06-09
 */
(function(n){"use strict";typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?module.exports=n:typeof define=="function"?define.amd||define(["jquery"],n):window.editormd=n()})(function(){"use strict";var t=typeof jQuery!="undefined"?jQuery:Zepto,n,i,r,u,e,f,o;if(typeof t!="undefined")return n=function(t,i){return new n.fn.init(t,i)},n.title=n.$name="Editor.md",n.version="1.5.0",n.homePage="https://pandao.github.io/editor.md/",n.classPrefix="editormd-",n.toolbarModes={full:["undo","redo","|","bold","del","italic","quote","ucwords","uppercase","lowercase","|","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","|","link","reference-link","image","code","preformatted-text","code-block","table","datetime","emoji","html-entities","pagebreak","|","goto-line","watch","preview","fullscreen","clear","search","|","help","info"],simple:["undo","redo","|","bold","del","italic","quote","uppercase","lowercase","|","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","|","watch","preview","fullscreen","|","help","info"],mini:["undo","redo","|","watch","preview","|","help","info"]},n.defaults={mode:"gfm",name:"",value:"",theme:"",editorTheme:"default",previewTheme:"",markdown:"",appendMarkdown:"",width:"100%",height:"100%",path:"./lib/",pluginPath:"",delay:300,autoLoadModules:!0,watch:!0,placeholder:"Enjoy Markdown! coding now...",gotoLine:!0,codeFold:!1,autoHeight:!1,autoFocus:!0,autoCloseTags:!0,searchReplace:!0,syncScrolling:!0,readOnly:!1,tabSize:4,indentUnit:4,lineNumbers:!0,lineWrapping:!0,autoCloseBrackets:!0,showTrailingSpace:!0,matchBrackets:!0,indentWithTabs:!0,styleSelectedText:!0,matchWordHighlight:!0,styleActiveLine:!0,dialogLockScreen:!0,dialogShowMask:!0,dialogDraggable:!0,dialogMaskBgColor:"#fff",dialogMaskOpacity:.1,fontSize:"13px",saveHTMLToTextarea:!1,disabledKeyMaps:[],onload:function(){},onresize:function(){},onchange:function(){},onwatch:null,onunwatch:null,onpreviewing:function(){},onpreviewed:function(){},onfullscreen:function(){},onfullscreenExit:function(){},onscroll:function(){},onpreviewscroll:function(){},imageUpload:!1,imageFormats:["jpg","jpeg","gif","png","bmp","webp"],imageUploadURL:"",crossDomainUpload:!1,uploadCallbackURL:"",toc:!0,tocm:!1,tocTitle:"",tocDropdown:!1,tocContainer:"",tocStartLevel:1,htmlDecode:!1,pageBreak:!0,atLink:!0,emailLink:!0,taskList:!1,emoji:!1,tex:!1,flowChart:!1,sequenceDiagram:!1,previewCodeHighlight:!0,toolbar:!0,toolbarAutoFixed:!0,toolbarIcons:"full",toolbarTitles:{},toolbarHandlers:{ucwords:function(){return n.toolbarHandlers.ucwords},lowercase:function(){return n.toolbarHandlers.lowercase}},toolbarCustomIcons:{lowercase:'<a href="javascript:;" title="Lowercase" unselectable="on"><i class="fa" name="lowercase" style="font-size:24px;margin-top: -10px;">a<\/i><\/a>',ucwords:'<a href="javascript:;" title="ucwords" unselectable="on"><i class="fa" name="ucwords" style="font-size:20px;margin-top: -3px;">Aa<\/i><\/a>'},toolbarIconsClass:{undo:"fa-undo",redo:"fa-repeat",bold:"fa-bold",del:"fa-strikethrough",italic:"fa-italic",quote:"fa-quote-left",uppercase:"fa-font",h1:n.classPrefix+"bold",h2:n.classPrefix+"bold",h3:n.classPrefix+"bold",h4:n.classPrefix+"bold",h5:n.classPrefix+"bold",h6:n.classPrefix+"bold","list-ul":"fa-list-ul","list-ol":"fa-list-ol",hr:"fa-minus",link:"fa-link","reference-link":"fa-anchor",image:"fa-picture-o",code:"fa-code","preformatted-text":"fa-file-code-o","code-block":"fa-file-code-o",table:"fa-table",datetime:"fa-clock-o",emoji:"fa-smile-o","html-entities":"fa-copyright",pagebreak:"fa-newspaper-o","goto-line":"fa-terminal",watch:"fa-eye-slash",unwatch:"fa-eye",preview:"fa-desktop",search:"fa-search",fullscreen:"fa-arrows-alt",clear:"fa-eraser",help:"fa-question-circle",info:"fa-info-circle"},toolbarIconTexts:{},lang:{name:"zh-cn",description:"开源在线Markdown编辑器<br/>Open source online Markdown editor.",tocTitle:"目录",toolbar:{undo:"撤销（Ctrl+Z）",redo:"重做（Ctrl+Y）",bold:"粗体",del:"删除线",italic:"斜体",quote:"引用",ucwords:"将每个单词首字母转成大写",uppercase:"将所选转换成大写",lowercase:"将所选转换成小写",h1:"标题1",h2:"标题2",h3:"标题3",h4:"标题4",h5:"标题5",h6:"标题6","list-ul":"无序列表","list-ol":"有序列表",hr:"横线",link:"链接","reference-link":"引用链接",image:"添加图片",code:"行内代码","preformatted-text":"预格式文本 / 代码块（缩进风格）","code-block":"代码块（多语言风格）",table:"添加表格",datetime:"日期时间",emoji:"Emoji表情","html-entities":"HTML实体字符",pagebreak:"插入分页符","goto-line":"跳转到行",watch:"关闭实时预览",unwatch:"开启实时预览",preview:"全窗口预览HTML（按 Shift + ESC还原）",fullscreen:"全屏（按ESC还原）",clear:"清空",search:"搜索",help:"使用帮助",info:"关于"+n.title},buttons:{enter:"确定",cancel:"取消",close:"关闭"},dialog:{link:{title:"添加链接",url:"链接地址",urlTitle:"链接标题",urlEmpty:"错误：请填写链接地址。"},referenceLink:{title:"添加引用链接",name:"引用名称",url:"链接地址",urlId:"链接ID",urlTitle:"链接标题",nameEmpty:"错误：引用链接的名称不能为空。",idEmpty:"错误：请填写引用链接的ID。",urlEmpty:"错误：请填写引用链接的URL地址。"},image:{title:"添加图片",url:"图片地址",link:"图片链接",alt:"图片描述",uploadButton:"本地上传",imageURLEmpty:"错误：图片地址不能为空。",uploadFileEmpty:"错误：上传的图片不能为空。",formatNotAllowed:"错误：只允许上传图片文件，允许上传的图片文件格式有："},preformattedText:{title:"添加预格式文本或代码块",emptyAlert:"错误：请填写预格式文本或代码的内容。"},codeBlock:{title:"添加代码块",selectLabel:"代码语言：",selectDefaultText:"请选择代码语言",otherLanguage:"其他语言",unselectedLanguageAlert:"错误：请选择代码所属的语言类型。",codeEmptyAlert:"错误：请填写代码内容。"},htmlEntities:{title:"HTML 实体字符"},help:{title:"使用帮助"}}}},n.classNames={tex:n.classPrefix+"tex"},n.dialogZindex=99999,n.$katex=null,n.$marked=null,n.$CodeMirror=null,n.$prettyPrint=null,n.prototype=n.fn={state:{watching:!1,loaded:!1,preview:!1,fullscreen:!1},init:function(i,r){var e,s,o,h;r=r||{};typeof i=="object"&&(r=i);var c=this,f=this.classPrefix=n.classPrefix,u=this.settings=t.extend(!0,n.defaults,r);return i=typeof i=="object"?u.id:i,e=this.editor=t("#"+i),this.id=i,this.lang=u.lang,s=this.classNames={textarea:{html:f+"html-textarea",markdown:f+"markdown-textarea"}},u.pluginPath=u.pluginPath===""?u.path+"../plugins/":u.pluginPath,this.state.watching=u.watch?!0:!1,e.hasClass("editormd")||e.addClass("editormd"),e.css({width:typeof u.width=="number"?u.width+"px":u.width,height:typeof u.height=="number"?u.height+"px":u.height}),u.autoHeight&&e.css("height","auto"),o=this.markdownTextarea=e.children("textarea"),o.length<1&&(e.append("<textarea><\/textarea>"),o=this.markdownTextarea=e.children("textarea")),o.addClass(s.textarea.markdown).attr("placeholder",u.placeholder),(typeof o.attr("name")=="undefined"||o.attr("name")==="")&&o.attr("name",u.name!==""?u.name:i+"-markdown-doc"),h=[u.readOnly?"":'<a href="javascript:;" class="fa fa-close '+f+'preview-close-btn"><\/a>',u.saveHTMLToTextarea?'<textarea class="'+s.textarea.html+'" name="'+i+'-html-code"><\/textarea>':"",'<div class="'+f+'preview"><div class="markdown-body '+f+'preview-container"><\/div><\/div>','<div class="'+f+'container-mask" style="display:block;"><\/div>','<div class="'+f+'mask"><\/div>'].join("\n"),e.append(h).addClass(f+"vertical"),u.theme!==""&&e.addClass(f+"theme-"+u.theme),this.mask=e.children("."+f+"mask"),this.containerMask=e.children("."+f+"container-mask"),u.markdown!==""&&o.val(u.markdown),u.appendMarkdown!==""&&o.val(o.val()+u.appendMarkdown),this.htmlTextarea=e.children("."+s.textarea.html),this.preview=e.children("."+f+"preview"),this.previewContainer=this.preview.children("."+f+"preview-container"),u.previewTheme!==""&&this.preview.addClass(f+"preview-theme-"+u.previewTheme),typeof define=="function"&&define.amd&&(typeof katex!="undefined"&&(n.$katex=katex),u.searchReplace&&!u.readOnly&&(n.loadCSS(u.path+"codemirror/addon/dialog/dialog"),n.loadCSS(u.path+"codemirror/addon/search/matchesonscrollbar"))),typeof define=="function"&&define.amd||!u.autoLoadModules?(typeof CodeMirror!="undefined"&&(n.$CodeMirror=CodeMirror),typeof marked!="undefined"&&(n.$marked=marked),this.setCodeMirror().setToolbar().loadedDisplay()):this.loadQueues(),this},loadQueues:function(){var r=this,i=this.settings,t=i.path,u=function(){if(n.isIE8){r.loadedDisplay();return}i.flowChart||i.sequenceDiagram?n.loadScript(t+"raphael.min",function(){n.loadScript(t+"underscore.min",function(){!i.flowChart&&i.sequenceDiagram?n.loadScript(t+"sequence-diagram.min",function(){r.loadedDisplay()}):i.flowChart&&!i.sequenceDiagram?n.loadScript(t+"flowchart.min",function(){n.loadScript(t+"jquery.flowchart.min",function(){r.loadedDisplay()})}):i.flowChart&&i.sequenceDiagram&&n.loadScript(t+"flowchart.min",function(){n.loadScript(t+"jquery.flowchart.min",function(){n.loadScript(t+"sequence-diagram.min",function(){r.loadedDisplay()})})})})}):r.loadedDisplay()};return n.loadCSS(t+"codemirror/codemirror.min"),i.searchReplace&&!i.readOnly&&(n.loadCSS(t+"codemirror/addon/dialog/dialog"),n.loadCSS(t+"codemirror/addon/search/matchesonscrollbar")),i.codeFold&&n.loadCSS(t+"codemirror/addon/fold/foldgutter"),n.loadScript(t+"codemirror/codemirror.min",function(){n.$CodeMirror=CodeMirror;n.loadScript(t+"codemirror/modes.min",function(){n.loadScript(t+"codemirror/addons.min",function(){if(r.setCodeMirror(),i.mode!=="gfm"&&i.mode!=="markdown")return r.loadedDisplay(),!1;r.setToolbar();n.loadScript(t+"marked.min",function(){n.$marked=marked;i.previewCodeHighlight?n.loadScript(t+"prettify.min",function(){u()}):u()})})})}),this},setTheme:function(n){var i=this.editor,r=this.settings.theme,t=this.classPrefix+"theme-";return i.removeClass(t+r).addClass(t+n),this.settings.theme=n,this},setEditorTheme:function(t){var i=this.settings;return i.editorTheme=t,t!=="default"&&n.loadCSS(i.path+"codemirror/theme/"+i.editorTheme),this.cm.setOption("theme",t),this},setCodeMirrorTheme:function(n){return this.setEditorTheme(n),this},setPreviewTheme:function(n){var i=this.preview,r=this.settings.previewTheme,t=this.classPrefix+"preview-theme-";return i.removeClass(t+r).addClass(t+n),this.settings.previewTheme=n,this},setCodeMirror:function(){var t=this.settings,r=this.editor,i;return t.editorTheme!=="default"&&n.loadCSS(t.path+"codemirror/theme/"+t.editorTheme),i={mode:t.mode,theme:t.editorTheme,tabSize:t.tabSize,dragDrop:!1,autofocus:t.autoFocus,autoCloseTags:t.autoCloseTags,readOnly:t.readOnly?"nocursor":!1,indentUnit:t.indentUnit,lineNumbers:t.lineNumbers,lineWrapping:t.lineWrapping,extraKeys:{"Ctrl-Q":function(n){n.foldCode(n.getCursor())}},foldGutter:t.codeFold,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],matchBrackets:t.matchBrackets,indentWithTabs:t.indentWithTabs,styleActiveLine:t.styleActiveLine,styleSelectedText:t.styleSelectedText,autoCloseBrackets:t.autoCloseBrackets,showTrailingSpace:t.showTrailingSpace,highlightSelectionMatches:t.matchWordHighlight?{showToken:t.matchWordHighlight==="onselected"?!1:/\w/}:!1},this.codeEditor=this.cm=n.$CodeMirror.fromTextArea(this.markdownTextarea[0],i),this.codeMirror=this.cmElement=r.children(".CodeMirror"),t.value!==""&&this.cm.setValue(t.value),this.codeMirror.css({fontSize:t.fontSize,width:t.watch?"50%":"100%"}),t.autoHeight&&(this.codeMirror.css("height","auto"),this.cm.setOption("viewportMargin",Infinity)),t.lineNumbers||this.codeMirror.find(".CodeMirror-gutters").css("border-right","none"),this},getCodeMirrorOption:function(n){return this.cm.getOption(n)},setCodeMirrorOption:function(n,t){return this.cm.setOption(n,t),this},addKeyMap:function(n,t){return this.cm.addKeyMap(n,t),this},removeKeyMap:function(n){return this.cm.removeKeyMap(n),this},gotoLine:function(n){var o=this.settings;if(!o.gotoLine)return this;var i=this.cm,v=this.editor,f=i.lineCount(),r=this.preview;if(typeof n=="string"&&(n==="last"&&(n=f),n==="first"&&(n=1)),typeof n!="number")return alert("Error: The line number must be an integer."),this;if(n=parseInt(n)-1,n>f)return alert("Error: The line number range 1-"+f),this;i.setCursor({line:n,ch:0});var h=i.getScrollInfo(),c=h.clientHeight,s=i.charCoords({line:n,ch:0},"local");if(i.scrollTo(null,(s.top+s.bottom-c)/2),o.watch){var u=this.codeMirror.find(".CodeMirror-scroll")[0],l=t(u).height(),e=u.scrollTop,a=e/u.scrollHeight;e===0?r.scrollTop(0):e+l>=u.scrollHeight-16?r.scrollTop(r[0].scrollHeight):r.scrollTop(r[0].scrollHeight*a)}return i.focus(),this},extend:function(){return typeof arguments[1]!="undefined"&&(typeof arguments[1]=="function"&&(arguments[1]=t.proxy(arguments[1],this)),this[arguments[0]]=arguments[1]),typeof arguments[0]=="object"&&typeof arguments[0].length=="undefined"&&t.extend(!0,this,arguments[0]),this},set:function(n,i){return typeof i!="undefined"&&typeof i=="function"&&(i=t.proxy(i,this)),this[n]=i,this},config:function(n,i){var r=this.settings;return typeof n=="object"&&(r=t.extend(!0,r,n)),typeof n=="string"&&(r[n]=i),this.settings=r,this.recreate(),this},on:function(n,i){var r=this.settings;return typeof r["on"+n]!="undefined"&&(r["on"+n]=t.proxy(i,this)),this},off:function(n){var t=this.settings;return typeof t["on"+n]!="undefined"&&(t["on"+n]=function(){}),this},showToolbar:function(n){var i=this.settings;return i.readOnly?this:(i.toolbar&&(this.toolbar.length<1||this.toolbar.find("."+this.classPrefix+"menu").html()==="")&&this.setToolbar(),i.toolbar=!0,this.toolbar.show(),this.resize(),t.proxy(n||function(){},this)(),this)},hideToolbar:function(n){var i=this.settings;return i.toolbar=!1,this.toolbar.hide(),this.resize(),t.proxy(n||function(){},this)(),this},setToolbarAutoFixed:function(n){var u=this.state,i=this.editor,f=this.toolbar,r=this.settings,e;return typeof n!="undefined"&&(r.toolbarAutoFixed=n),e=function(){var n=t(window),u=n.scrollTop();if(!r.toolbarAutoFixed)return!1;u-i.offset().top>10&&u<i.height()?f.css({position:"fixed",width:i.width()+"px",left:(n.width()-i.width())/2+"px"}):f.css({position:"absolute",width:"100%",left:0})},!u.fullscreen&&!u.preview&&r.toolbar&&r.toolbarAutoFixed&&t(window).bind("scroll",e),this},setToolbar:function(){var t=this.settings,p,h,b,i,k,o,r;if(t.readOnly)return this;var a=this.editor,d=this.preview,u=this.classPrefix,f=this.toolbar=a.children("."+u+"toolbar");if(t.toolbar&&f.length<1&&(p='<div class="'+u+'toolbar"><div class="'+u+'toolbar-container"><ul class="'+u+'menu"><\/ul><\/div><\/div>',a.append(p),f=this.toolbar=a.children("."+u+"toolbar")),!t.toolbar)return f.hide(),this;f.show();var w=typeof t.toolbarIcons=="function"?t.toolbarIcons():typeof t.toolbarIcons=="string"?n.toolbarModes[t.toolbarIcons]:t.toolbarIcons,v=f.find("."+this.classPrefix+"menu"),e="",y=!1;for(h=0,b=w.length;h<b;h++)if(i=w[h],i==="||")y=!0;else if(i==="|")e+='<li class="divider" unselectable="on">|<\/li>';else{k=/h(\d)/.test(i);o=i;i!=="watch"||t.watch||(o="unwatch");var c=t.lang.toolbar[o],l=t.toolbarIconTexts[o],s=t.toolbarIconsClass[o];c=typeof c=="undefined"?"":c;l=typeof l=="undefined"?"":l;s=typeof s=="undefined"?"":s;r=y?'<li class="pull-right">':"<li>";typeof t.toolbarCustomIcons[i]!="undefined"&&typeof t.toolbarCustomIcons[i]!="function"?r+=t.toolbarCustomIcons[i]:(r+='<a href="javascript:;" title="'+c+'" unselectable="on">',r+='<i class="fa '+s+'" name="'+i+'" unselectable="on">'+(k?i.toUpperCase():s===""?l:"")+"<\/i>",r+="<\/a>");r+="<\/li>";e=y?r+e:e+r}return v.html(e),v.find('[title="Lowercase"]').attr("title",t.lang.toolbar.lowercase),v.find('[title="ucwords"]').attr("title",t.lang.toolbar.ucwords),this.setToolbarHandler(),this.setToolbarAutoFixed(),this},dialogLockScreen:function(){return t.proxy(n.dialogLockScreen,this)(),this},dialogShowMask:function(i){return t.proxy(n.dialogShowMask,this)(i),this},getToolbarHandles:function(t){var i=this.toolbarHandlers=n.toolbarHandlers;return t&&typeof toolbarIconHandlers[t]!="undefined"?i[t]:i},setToolbarHandler:function(){var u=this,r=this.settings;if(!r.toolbar||r.readOnly)return this;var e=this.toolbar,i=this.cm,o=this.classPrefix,s=this.toolbarIcons=e.find("."+o+"menu > li > a"),f=this.getToolbarHandles();return s.bind(n.mouseOrTouch("click","touchend"),function(){var e=t(this).children(".fa"),n=e.attr("name"),o=i.getCursor(),s=i.getSelection();if(n!=="")return u.activeIcon=e,typeof f[n]!="undefined"?t.proxy(f[n],u)(i):typeof r.toolbarHandlers[n]!="undefined"&&t.proxy(r.toolbarHandlers[n],u)(i,e,o,s),n!=="link"&&n!=="reference-link"&&n!=="image"&&n!=="code-block"&&n!=="preformatted-text"&&n!=="watch"&&n!=="preview"&&n!=="search"&&n!=="fullscreen"&&n!=="info"&&i.focus(),!1}),this},createDialog:function(i){return t.proxy(n.createDialog,this)(i)},createInfoDialog:function(){var u=this,r=this.editor,t=this.classPrefix,f=['<div class="'+t+"dialog "+t+'dialog-info" style="">','<div class="'+t+'dialog-container">','<h1><i class="editormd-logo editormd-logo-lg editormd-logo-color"><\/i> '+n.title+"<small>v"+n.version+"<\/small><\/h1>","<p>"+this.lang.description+"<\/p>",'<p style="margin: 10px 0 20px 0;"><a href="'+n.homePage+'" target="_blank">'+n.homePage+' <i class="fa fa-external-link"><\/i><\/a><\/p>','<p style="font-size: 0.85em;">Copyright &copy; 2015 <a href="https://github.com/pandao" target="_blank" class="hover-link">Pandao<\/a>, The <a href="https://github.com/pandao/editor.md/blob/master/LICENSE" target="_blank" class="hover-link">MIT<\/a> License.<\/p>',"<\/div>",'<a href="javascript:;" class="fa fa-close '+t+'dialog-close"><\/a>',"<\/div>"].join("\n"),i;return r.append(f),i=this.infoDialog=r.children("."+t+"dialog-info"),i.find("."+t+"dialog-close").bind(n.mouseOrTouch("click","touchend"),function(){u.hideInfoDialog()}),i.css("border",n.isIE8?"1px solid #ddd":"").css("z-index",n.dialogZindex).show(),this.infoDialogPosition(),this},infoDialogPosition:function(){var n=this.infoDialog,i=function(){n.css({top:(t(window).height()-n.height())/2+"px",left:(t(window).width()-n.width())/2+"px"})};return i(),t(window).resize(i),this},showInfoDialog:function(){t("html,body").css("overflow-x","hidden");var f=this,u=this.editor,i=this.settings,r=this.infoDialog=u.children("."+this.classPrefix+"dialog-info");return r.length<1&&this.createInfoDialog(),this.lockScreen(!0),this.mask.css({opacity:i.dialogMaskOpacity,backgroundColor:i.dialogMaskBgColor}).show(),r.css("z-index",n.dialogZindex).show(),this.infoDialogPosition(),this},hideInfoDialog:function(){return t("html,body").css("overflow-x",""),this.infoDialog.hide(),this.mask.hide(),this.lockScreen(!1),this},lockScreen:function(t){return n.lockScreen(t),this.resize(),this},recreate:function(n){var r=this,t=this.editor,i=this.settings;return this.codeMirror?(this.setCodeMirror(),i.readOnly||(t.find(".editormd-dialog").length>0&&t.find(".editormd-dialog").remove(),i.toolbar&&(this.getToolbarHandles(),this.setToolbar())),this.loadedDisplay(!0),n&&n(),this):(setTimeout(function(){console.log("################### Run background ####################");r.recreate(n)},200),this)},previewCodeHighlight:function(){var n=this.settings,t=this.previewContainer;return n.previewCodeHighlight&&(t.find("pre").addClass("prettyprint linenums"),typeof prettyPrint!="undefined"&&prettyPrint()),this},katexRender:function(){return i===null?this:(this.previewContainer.find("."+n.classNames.tex).each(function(){var i=t(this);n.$katex.render(i.text(),i[0]);i.find(".katex").css("font-size","1.6em")}),this)},flowChartAndSequenceDiagramRender:function(){var o=this,s=this.settings,h=this.previewContainer,u;if(n.isIE8)return this;if(s.flowChart){if(r===null)return this;h.find(".flowchart").flowChart()}s.sequenceDiagram&&h.find(".sequence-diagram").sequenceDiagram({theme:"simple"});var i=o.preview,l=o.codeMirror,f=l.find(".CodeMirror-scroll"),a=f.height(),e=f.scrollTop(),v=e/f[0].scrollHeight,c=0;return i.find(".markdown-toc-list").each(function(){c+=t(this).height()}),u=i.find(".editormd-toc-menu").height(),u=u?u:0,e===0?i.scrollTop(0):e+a>=f[0].scrollHeight-16?i.scrollTop(i[0].scrollHeight):i.scrollTop((i[0].scrollHeight+c+u)*v),this},registerKeyMaps:function(i){var r=this,c=this.cm,v=this.settings,f=n.toolbarHandlers,s=v.disabledKeyMaps,e,l,u,o,a,h;if(i=i||null,i)for(e in i)t.inArray(e,s)<0&&(l={},l[e]=i[e],c.addKeyMap(i));else{for(u in n.keyMaps)o=n.keyMaps[u],a=typeof o=="string"?t.proxy(f[o],r):t.proxy(o,r),t.inArray(u,["F9","F10","F11"])<0&&t.inArray(u,s)<0&&(h={},h[u]=a,c.addKeyMap(h));t(window).keydown(function(n){if(t.inArray({"120":"F9","121":"F10","122":"F11"}[n.keyCode],s)<0)switch(n.keyCode){case 120:return t.proxy(f.watch,r)(),!1;case 121:return t.proxy(f.preview,r)(),!1;case 122:return t.proxy(f.fullscreen,r)(),!1}})}return this},bindScrollEvent:function(){var e=this,i=this.preview,r=this.settings,u=this.codeMirror,f=n.mouseOrTouch;if(!r.syncScrolling)return this;var o=function(){u.find(".CodeMirror-scroll").bind(f("scroll","touchmove"),function(n){var s=t(this).height(),f=t(this).scrollTop(),h=f/t(this)[0].scrollHeight,o=0,u;i.find(".markdown-toc-list").each(function(){o+=t(this).height()});u=i.find(".editormd-toc-menu").height();u=u?u:0;f===0?i.scrollTop(0):f+s>=t(this)[0].scrollHeight-16?i.scrollTop(i[0].scrollHeight):i.scrollTop((i[0].scrollHeight+o+u)*h);t.proxy(r.onscroll,e)(n)})},s=function(){u.find(".CodeMirror-scroll").unbind(f("scroll","touchmove"))},h=function(){i.bind(f("scroll","touchmove"),function(n){var o=t(this).height(),f=t(this).scrollTop(),s=f/t(this)[0].scrollHeight,i=u.find(".CodeMirror-scroll");f===0?i.scrollTop(0):f+o>=t(this)[0].scrollHeight?i.scrollTop(i[0].scrollHeight):i.scrollTop(i[0].scrollHeight*s);t.proxy(r.onpreviewscroll,e)(n)})},c=function(){i.unbind(f("scroll","touchmove"))};return(u.bind({mouseover:o,mouseout:s,touchstart:o,touchend:s}),r.syncScrolling==="single")?this:(i.bind({mouseover:h,mouseout:c,touchstart:h,touchend:c}),this)},bindChangeEvent:function(){var t=this,r=this.cm,n=this.settings;if(!n.syncScrolling)return this;r.on("change",function(){n.watch&&t.previewContainer.css("padding",n.autoHeight?"20px 20px 50px 40px":"20px");i=setTimeout(function(){clearTimeout(i);t.save();i=null},n.delay)});return this},loadedDisplay:function(n){n=n||!1;var u=this,i=this.editor,f=this.preview,r=this.settings;return this.containerMask.hide(),this.save(),r.watch&&f.show(),i.data("oldWidth",i.width()).data("oldHeight",i.height()),this.resize(),this.registerKeyMaps(),t(window).resize(function(){u.resize()}),this.bindScrollEvent().bindChangeEvent(),n||t.proxy(r.onload,this)(),this.state.loaded=!0,this},width:function(n){return this.editor.css("width",typeof n=="number"?n+"px":n),this.resize(),this},height:function(n){return this.editor.css("height",typeof n=="number"?n+"px":n),this.resize(),this},resize:function(n,i){var h;n=n||null;i=i||null;var f=this.state,r=this.editor,e=this.preview,s=this.toolbar,u=this.settings,o=this.codeMirror;return n&&r.css("width",typeof n=="number"?n+"px":n),!u.autoHeight||f.fullscreen||f.preview?(i&&r.css("height",typeof i=="number"?i+"px":i),f.fullscreen&&r.height(t(window).height()),u.toolbar&&!u.readOnly?o.css("margin-top",s.height()+1).height(r.height()-s.height()):o.css("margin-top",0).height(r.height())):(r.css("height","auto"),o.css("height","auto")),u.watch?(o.width(r.width()/2),e.width(f.preview?r.width():r.width()/2),this.previewContainer.css("padding",u.autoHeight?"20px 20px 50px 40px":"20px"),u.toolbar&&!u.readOnly?e.css("top",s.height()+1):e.css("top",0),!u.autoHeight||f.fullscreen||f.preview?(h=u.toolbar&&!u.readOnly?r.height()-s.height():r.height(),e.height(h)):e.height("")):(o.width(r.width()),e.hide()),f.loaded&&t.proxy(u.onresize,this)(),this},save:function(){var e,f,h;if(i===null)return this;var c=this,l=this.state,u=this.settings,a=this.cm,o=a.getValue(),s=this.previewContainer;if(u.mode!=="gfm"&&u.mode!=="markdown")return this.markdownTextarea.val(o),this;var p=n.$marked,v=this.markdownToC=[],w=this.markedRendererOptions={toc:u.toc,tocm:u.tocm,tocStartLevel:u.tocStartLevel,pageBreak:u.pageBreak,taskList:u.taskList,emoji:u.emoji,tex:u.tex,atLink:u.atLink,emailLink:u.emailLink,flowChart:u.flowChart,sequenceDiagram:u.sequenceDiagram,previewCodeHighlight:u.previewCodeHighlight},y=this.markedOptions={renderer:n.markedRenderer(v,w),gfm:!0,tables:!0,breaks:!0,pedantic:!1,sanitize:u.htmlDecode?!1:!0,smartLists:!0,smartypants:!0};return p.setOptions(y),e=n.$marked(o,y),e=n.filterHTMLTags(e,u.htmlDecode),this.markdownTextarea.text(o),a.save(),u.saveHTMLToTextarea&&this.htmlTextarea.text(e),(u.watch||!u.watch&&l.preview)&&(s.html(e),this.previewCodeHighlight(),u.toc&&(f=u.tocContainer===""?s:t(u.tocContainer),h=f.find("."+this.classPrefix+"toc-menu"),f.attr("previewContainer",u.tocContainer===""?"true":"false"),u.tocContainer!==""&&h.length>0&&h.remove(),n.markdownToCRenderer(v,f,u.tocDropdown,u.tocStartLevel),(u.tocDropdown||f.find("."+this.classPrefix+"toc-menu").length>0)&&n.tocDropdownMenu(f,u.tocTitle!==""?u.tocTitle:this.lang.tocTitle),u.tocContainer!==""&&s.find(".markdown-toc").css("border","none")),u.tex&&(!n.kaTeXLoaded&&u.autoLoadModules?n.loadKaTeX(function(){n.$katex=katex;n.kaTeXLoaded=!0;c.katexRender()}):(n.$katex=katex,this.katexRender())),(u.flowChart||u.sequenceDiagram)&&(r=setTimeout(function(){clearTimeout(r);c.flowChartAndSequenceDiagramRender();r=null},10)),l.loaded&&t.proxy(u.onchange,this)()),this},focus:function(){return this.cm.focus(),this},setCursor:function(n){return this.cm.setCursor(n),this},getCursor:function(){return this.cm.getCursor()},setSelection:function(n,t){return this.cm.setSelection(n,t),this},getSelection:function(){return this.cm.getSelection()},setSelections:function(n){return this.cm.setSelections(n),this},getSelections:function(){return this.cm.getSelections()},replaceSelection:function(n){return this.cm.replaceSelection(n),this},insertValue:function(n){return this.replaceSelection(n),this},appendMarkdown:function(n){var i=this.settings,t=this.cm;return t.setValue(t.getValue()+n),this},setMarkdown:function(n){return this.cm.setValue(n||this.settings.markdown),this},getMarkdown:function(){return this.cm.getValue()},getValue:function(){return this.cm.getValue()},setValue:function(n){return this.cm.setValue(n),this},clear:function(){return this.cm.setValue(""),this},getHTML:function(){return this.settings.saveHTMLToTextarea?this.htmlTextarea.val():(alert("Error: settings.saveHTMLToTextarea == false"),!1)},getTextareaSavedHTML:function(){return this.getHTML()},getPreviewedHTML:function(){return this.settings.watch?this.previewContainer.html():(alert("Error: settings.watch == false"),!1)},watch:function(n){var r=this.settings;if(t.inArray(r.mode,["gfm","markdown"])<0)return this;if(this.state.watching=r.watch=!0,this.preview.show(),this.toolbar){var f=r.toolbarIconsClass.watch,e=r.toolbarIconsClass.unwatch,u=this.toolbar.find(".fa[name=watch]");u.parent().attr("title",r.lang.toolbar.watch);u.removeClass(e).addClass(f)}return this.codeMirror.css("border-right","1px solid #ddd").width(this.editor.width()/2),i=0,this.save().resize(),r.onwatch||(r.onwatch=n||function(){}),t.proxy(r.onwatch,this)(),this},unwatch:function(n){var i=this.settings;if(this.state.watching=i.watch=!1,this.preview.hide(),this.toolbar){var u=i.toolbarIconsClass.watch,f=i.toolbarIconsClass.unwatch,r=this.toolbar.find(".fa[name=watch]");r.parent().attr("title",i.lang.toolbar.unwatch);r.removeClass(u).addClass(f)}return this.codeMirror.css("border-right","none").width(this.editor.width()),this.resize(),i.onunwatch||(i.onunwatch=n||function(){}),t.proxy(i.onunwatch,this)(),this},show:function(n){n=n||function(){};var i=this;return this.editor.show(0,function(){t.proxy(n,i)()}),this},hide:function(n){n=n||function(){};var i=this;return this.editor.hide(0,function(){t.proxy(n,i)()}),this},previewing:function(){var e=this,r=this.editor,o=this.preview,u=this.toolbar,i=this.settings,s=this.codeMirror,h=this.previewContainer,f;if(t.inArray(i.mode,["gfm","markdown"])<0)return this;i.toolbar&&u&&(u.toggle(),u.find(".fa[name=preview]").toggleClass("active"));s.toggle();f=function(n){n.shiftKey&&n.keyCode===27&&e.previewed()};s.css("display")==="none"?(this.state.preview=!0,this.state.fullscreen&&o.css("background","#fff"),r.find("."+this.classPrefix+"preview-close-btn").show().bind(n.mouseOrTouch("click","touchend"),function(){e.previewed()}),i.watch?h.css("padding",""):this.save(),h.addClass(this.classPrefix+"preview-active"),o.show().css({position:"",top:0,width:r.width(),height:i.autoHeight&&!this.state.fullscreen?"auto":r.height()}),this.state.loaded&&t.proxy(i.onpreviewing,this)(),t(window).bind("keyup",f)):(t(window).unbind("keyup",f),this.previewed())},previewed:function(){var r=this.editor,f=this.preview,u=this.toolbar,i=this.settings,e=this.previewContainer,o=r.find("."+this.classPrefix+"preview-close-btn");return this.state.preview=!1,this.codeMirror.show(),i.toolbar&&u.show(),f[i.watch?"show":"hide"](),o.hide().unbind(n.mouseOrTouch("click","touchend")),e.removeClass(this.classPrefix+"preview-active"),i.watch&&e.css("padding","20px"),f.css({background:null,position:"absolute",width:r.width()/2,height:i.autoHeight&&!this.state.fullscreen?"auto":r.height()-u.height(),top:i.toolbar?u.height():0}),this.state.loaded&&t.proxy(i.onpreviewed,this)(),this},fullscreen:function(){var e=this,i=this.state,r=this.editor,s=this.preview,u=this.toolbar,o=this.settings,f=this.classPrefix+"fullscreen",n;return u&&u.find(".fa[name=fullscreen]").parent().toggleClass("active"),n=function(n){n.shiftKey||n.keyCode!==27||i.fullscreen&&e.fullscreenExit()},r.hasClass(f)?(t(window).unbind("keyup",n),this.fullscreenExit()):(i.fullscreen=!0,t("html,body").css("overflow","hidden"),r.css({width:t(window).width(),height:t(window).height()}).addClass(f),this.resize(),t.proxy(o.onfullscreen,this)(),t(window).bind("keyup",n)),this},fullscreenExit:function(){var n=this.editor,r=this.settings,i=this.toolbar,u=this.classPrefix+"fullscreen";return this.state.fullscreen=!1,i&&i.find(".fa[name=fullscreen]").parent().removeClass("active"),t("html,body").css("overflow",""),n.css({width:n.data("oldWidth"),height:n.data("oldHeight")}).removeClass(u),this.resize(),t.proxy(r.onfullscreenExit,this)(),this},executePlugin:function(i,r){var f=this,u=this.cm,e=this.settings;return(r=e.pluginPath+r,typeof define=="function")?typeof this[i]=="undefined"?(alert("Error: "+i+" plugin is not found, you are not load this plugin."),this):(this[i](u),this):(t.inArray(r,n.loadFiles.plugin)<0?n.loadPlugin(r,function(){n.loadPlugins[i]=f[i];f[i](u)}):t.proxy(n.loadPlugins[i],this)(u),this)},search:function(n){var t=this.settings;return t.searchReplace?(t.readOnly||this.cm.execCommand(n||"find"),this):(alert("Error: settings.searchReplace == false"),this)},searchReplace:function(){return this.search("replace"),this},searchReplaceAll:function(){return this.search("replaceAll"),this}},n.fn.init.prototype=n.fn,n.dialogLockScreen=function(){var n=this.settings||{dialogLockScreen:!0};n.dialogLockScreen&&(t("html,body").css("overflow","hidden"),this.resize())},n.dialogShowMask=function(n){var i=this.editor,r=this.settings||{dialogShowMask:!0};n.css({top:(t(window).height()-n.height())/2+"px",left:(t(window).width()-n.width())/2+"px"});r.dialogShowMask&&i.children("."+this.classPrefix+"mask").css("z-index",parseInt(n.css("z-index"))-1).show()},n.toolbarHandlers={undo:function(){this.cm.undo()},redo:function(){this.cm.redo()},bold:function(){var n=this.cm,t=n.getCursor(),i=n.getSelection();n.replaceSelection("**"+i+"**");i===""&&n.setCursor(t.line,t.ch+2)},del:function(){var n=this.cm,t=n.getCursor(),i=n.getSelection();n.replaceSelection("~~"+i+"~~");i===""&&n.setCursor(t.line,t.ch+2)},italic:function(){var n=this.cm,t=n.getCursor(),i=n.getSelection();n.replaceSelection("*"+i+"*");i===""&&n.setCursor(t.line,t.ch+1)},quote:function(){var n=this.cm,t=n.getCursor(),i=n.getSelection();t.ch!==0?(n.setCursor(t.line,0),n.replaceSelection("> "+i),n.setCursor(t.line,t.ch+2)):n.replaceSelection("> "+i)},ucfirst:function(){var t=this.cm,i=t.getSelection(),r=t.listSelections();t.replaceSelection(n.firstUpperCase(i));t.setSelections(r)},ucwords:function(){var t=this.cm,i=t.getSelection(),r=t.listSelections();t.replaceSelection(n.wordsFirstUpperCase(i));t.setSelections(r)},uppercase:function(){var n=this.cm,t=n.getSelection(),i=n.listSelections();n.replaceSelection(t.toUpperCase());n.setSelections(i)},lowercase:function(){var n=this.cm,r=n.getCursor(),t=n.getSelection(),i=n.listSelections();n.replaceSelection(t.toLowerCase());n.setSelections(i)},h1:function(){var n=this.cm,t=n.getCursor(),i=n.getSelection();t.ch!==0?(n.setCursor(t.line,0),n.replaceSelection("# "+i),n.setCursor(t.line,t.ch+2)):n.replaceSelection("# "+i)},h2:function(){var n=this.cm,t=n.getCursor(),i=n.getSelection();t.ch!==0?(n.setCursor(t.line,0),n.replaceSelection("## "+i),n.setCursor(t.line,t.ch+3)):n.replaceSelection("## "+i)},h3:function(){var n=this.cm,t=n.getCursor(),i=n.getSelection();t.ch!==0?(n.setCursor(t.line,0),n.replaceSelection("### "+i),n.setCursor(t.line,t.ch+4)):n.replaceSelection("### "+i)},h4:function(){var n=this.cm,t=n.getCursor(),i=n.getSelection();t.ch!==0?(n.setCursor(t.line,0),n.replaceSelection("#### "+i),n.setCursor(t.line,t.ch+5)):n.replaceSelection("#### "+i)},h5:function(){var n=this.cm,t=n.getCursor(),i=n.getSelection();t.ch!==0?(n.setCursor(t.line,0),n.replaceSelection("##### "+i),n.setCursor(t.line,t.ch+6)):n.replaceSelection("##### "+i)},h6:function(){var n=this.cm,t=n.getCursor(),i=n.getSelection();t.ch!==0?(n.setCursor(t.line,0),n.replaceSelection("###### "+i),n.setCursor(t.line,t.ch+7)):n.replaceSelection("###### "+i)},"list-ul":function(){var i=this.cm,f=i.getCursor(),r=i.getSelection(),n,t,u;if(r==="")i.replaceSelection("- "+r);else{for(n=r.split("\n"),t=0,u=n.length;t<u;t++)n[t]=n[t]===""?"":"- "+n[t];i.replaceSelection(n.join("\n"))}},"list-ol":function(){var i=this.cm,f=i.getCursor(),r=i.getSelection(),t,n,u;if(r==="")i.replaceSelection("1. "+r);else{for(t=r.split("\n"),n=0,u=t.length;n<u;n++)t[n]=t[n]===""?"":n+1+". "+t[n];i.replaceSelection(t.join("\n"))}},hr:function(){var n=this.cm,t=n.getCursor(),i=n.getSelection();n.replaceSelection((t.ch!==0?"\n\n":"\n")+"------------\n\n")},tex:function(){if(!this.settings.tex)return alert("settings.tex === false"),this;var n=this.cm,t=n.getCursor(),i=n.getSelection();n.replaceSelection("$$"+i+"$$");i===""&&n.setCursor(t.line,t.ch+2)},link:function(){this.executePlugin("linkDialog","link-dialog/link-dialog")},"reference-link":function(){this.executePlugin("referenceLinkDialog","reference-link-dialog/reference-link-dialog")},pagebreak:function(){if(!this.settings.pageBreak)return alert("settings.pageBreak === false"),this;var n=this.cm,t=n.getSelection();n.replaceSelection("\r\n[========]\r\n")},image:function(){this.executePlugin("imageDialog","image-dialog/image-dialog")},code:function(){var n=this.cm,t=n.getCursor(),i=n.getSelection();n.replaceSelection("`"+i+"`");i===""&&n.setCursor(t.line,t.ch+1)},"code-block":function(){this.executePlugin("codeBlockDialog","code-block-dialog/code-block-dialog")},"preformatted-text":function(){this.executePlugin("preformattedTextDialog","preformatted-text-dialog/preformatted-text-dialog")},table:function(){this.executePlugin("tableDialog","table-dialog/table-dialog")},datetime:function(){var t=this.cm,u=t.getSelection(),f=new Date,i=this.settings.lang.name,r=n.dateFormat()+" "+n.dateFormat(i==="zh-cn"||i==="zh-tw"?"cn-week-day":"week-day");t.replaceSelection(r)},emoji:function(){this.executePlugin("emojiDialog","emoji-dialog/emoji-dialog")},"html-entities":function(){this.executePlugin("htmlEntitiesDialog","html-entities-dialog/html-entities-dialog")},"goto-line":function(){this.executePlugin("gotoLineDialog","goto-line-dialog/goto-line-dialog")},watch:function(){this[this.settings.watch?"unwatch":"watch"]()},preview:function(){this.previewing()},fullscreen:function(){this.fullscreen()},clear:function(){this.clear()},search:function(){this.search()},help:function(){this.executePlugin("helpDialog","help-dialog/help-dialog")},info:function(){this.showInfoDialog()}},n.keyMaps={"Ctrl-1":"h1","Ctrl-2":"h2","Ctrl-3":"h3","Ctrl-4":"h4","Ctrl-5":"h5","Ctrl-6":"h6","Ctrl-B":"bold","Ctrl-D":"datetime","Ctrl-E":function(){var n=this.cm,t=n.getCursor(),i=n.getSelection();if(!this.settings.emoji){alert("Error: settings.emoji == false");return}n.replaceSelection(":"+i+":");i===""&&n.setCursor(t.line,t.ch+1)},"Ctrl-Alt-G":"goto-line","Ctrl-H":"hr","Ctrl-I":"italic","Ctrl-K":"code","Ctrl-L":function(){var n=this.cm,i=n.getCursor(),t=n.getSelection(),r=t===""?"":' "'+t+'"';n.replaceSelection("["+t+"]("+r+")");t===""&&n.setCursor(i.line,i.ch+1)},"Ctrl-U":"list-ul","Shift-Ctrl-A":function(){var n=this.cm,t=n.getCursor(),i=n.getSelection();if(!this.settings.atLink){alert("Error: settings.atLink == false");return}n.replaceSelection("@"+i);i===""&&n.setCursor(t.line,t.ch+1)},"Shift-Ctrl-C":"code","Shift-Ctrl-Q":"quote","Shift-Ctrl-S":"del","Shift-Ctrl-K":"tex","Shift-Alt-C":function(){var n=this.cm,t=n.getCursor(),i=n.getSelection();n.replaceSelection(["```",i,"```"].join("\n"));i===""&&n.setCursor(t.line,t.ch+3)},"Shift-Ctrl-Alt-C":"code-block","Shift-Ctrl-H":"html-entities","Shift-Alt-H":"help","Shift-Ctrl-E":"emoji","Shift-Ctrl-U":"uppercase","Shift-Alt-U":"ucwords","Shift-Ctrl-Alt-U":"ucfirst","Shift-Alt-L":"lowercase","Shift-Ctrl-I":function(){var n=this.cm,i=n.getCursor(),t=n.getSelection(),r=t===""?"":' "'+t+'"';n.replaceSelection("!["+t+"]("+r+")");t===""&&n.setCursor(i.line,i.ch+4)},"Shift-Ctrl-Alt-I":"image","Shift-Ctrl-L":"link","Shift-Ctrl-O":"list-ol","Shift-Ctrl-P":"preformatted-text","Shift-Ctrl-T":"table","Shift-Alt-P":"pagebreak",F9:"watch",F10:"preview",F11:"fullscreen"},u=function(n){return String.prototype.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},n.trim=u,e=function(n){return n.toLowerCase().replace(/\b(\w)|\s(\w)/g,function(n){return n.toUpperCase()})},n.ucwords=n.wordsFirstUpperCase=e,f=function(n){return n.toLowerCase().replace(/\b(\w)/,function(n){return n.toUpperCase()})},o=f,n.firstUpperCase=n.ucfirst=f,n.urls={atLinkBase:"https://github.com/"},n.regexs={atLink:/@(\w+)/g,email:/(\w+)@(\w+)\.(\w+)\.?(\w+)?/g,emailLink:/(mailto:)?([\w\.\_]+)@(\w+)\.(\w+)\.?(\w+)?/g,emoji:/:([\w\+-]+):/g,emojiDatetime:/(\d{2}:\d{2}:\d{2})/g,twemoji:/:(tw-([\w]+)-?(\w+)?):/g,fontAwesome:/:(fa-([\w]+)(-(\w+)){0,}):/g,editormdLogo:/:(editormd-logo-?(\w+)?):/g,pageBreak:/^\[[=]{8,}\]$/},n.emoji={path:"http://www.emoji-cheat-sheet.com/graphics/emojis/",ext:".png"},n.twemoji={path:"http://twemoji.maxcdn.com/36x36/",ext:".png"},n.markedRenderer=function(i,r){var o=t.extend({toc:!0,tocm:!1,tocStartLevel:1,pageBreak:!0,atLink:!0,emailLink:!0,taskList:!1,emoji:!1,tex:!1,flowChart:!1,sequenceDiagram:!1},r||{}),h=n.$marked,f=new h.Renderer;i=i||[];var e=n.regexs,s=e.atLink,l=e.emoji,a=e.email,v=e.emailLink,y=e.twemoji,p=e.fontAwesome,w=e.editormdLogo,c=e.pageBreak;return f.emoji=function(t){var i,r,u;if(t=t.replace(n.regexs.emojiDatetime,function(n){return n.replace(/:/g,"&#58;")}),i=t.match(l),!i||!o.emoji)return t;for(r=0,u=i.length;r<u;r++)i[r]===":+1:"&&(i[r]=":\\+1:"),t=t.replace(new RegExp(i[r]),function(t){var c=t.match(p),r=t.replace(/:/g,""),u,v,l,f,e,o,b,a,s,k,h,i;if(c)for(u=0,v=c.length;u<v;u++)return l=c[u].replace(/:/g,""),'<i class="fa '+l+' fa-emoji" title="'+l.replace("fa-","")+'"><\/i>';else if(f=t.match(w),e=t.match(y),f)for(o=0,b=f.length;o<b;o++)return a=f[o].replace(/:/g,""),'<i class="'+a+'" title="Editor.md logo ('+a+')"><\/i>';else if(e)for(s=0,k=e.length;s<k;s++)return h=e[s].replace(/:/g,"").replace("tw-",""),'<img src="'+n.twemoji.path+h+n.twemoji.ext+'" title="twemoji-'+h+'" alt="twemoji-'+h+'" class="emoji twemoji" />';else return i=r==="+1"?"plus1":r,i=i==="black_large_square"?"black_square":i,i=i==="moon"?"waxing_gibbous_moon":i,'<img src="'+n.emoji.path+i+n.emoji.ext+'" class="emoji" title="&#58;'+r+'&#58;" alt="&#58;'+r+'&#58;" />'});return t},f.atLink=function(i){return s.test(i)?(o.atLink&&(i=i.replace(a,function(n){return n.replace(/@/g,"_#_&#64;_#_")}),i=i.replace(s,function(t,i){return'<a href="'+n.urls.atLinkBase+""+i+'" title="&#64;'+i+'" class="at-link">'+t+"<\/a>"}).replace(/_#_&#64;_#_/g,"@")),o.emailLink&&(i=i.replace(v,function(n,i,r,u,f){return!i&&t.inArray(f,"jpg|jpeg|png|gif|webp|ico|icon|pdf".split("|"))<0?'<a href="mailto:'+n+'">'+n+"<\/a>":n})),i):i},f.link=function(n,t,i){var u,r;if(this.options.sanitize){try{u=decodeURIComponent(unescape(n)).replace(/[^\w:]/g,"").toLowerCase()}catch(f){return""}if(u.indexOf("javascript:")===0)return""}return(r='<a href="'+n+'"',s.test(t)||s.test(i))?(t&&(r+=' title="'+t.replace(/@/g,"&#64;")),r+'">'+i.replace(/@/g,"&#64;")+"<\/a>"):(t&&(r+=' title="'+t+'"'),r+(">"+i+"<\/a>"))},f.heading=function(n,t){var h=n,o=/\s*\<a\s*href\=\"(.*)\"\s*([^\>]*)\>(.*)\<\/a\>\s*/,e,f,s,r;if(o.test(n)){for(e=[],n=n.split(/\<a\s*([^\>]+)\>([^\>]*)\<\/a\>/),f=0,s=n.length;f<s;f++)e.push(n[f].replace(/\s*href\=\"(.*)\"\s*/g,""));n=e.join(" ")}n=u(n);var c=n.toLowerCase().replace(/[^\w]+/g,"-"),l={text:n,level:t,slug:c},a=/^[\u4e00-\u9fa5]+$/.test(n),v=a?escape(n).replace(/\%/g,""):n.toLowerCase().replace(/[^\w]+/g,"-");return i.push(l),r="<h"+t+' id="h'+t+"-"+this.options.headerPrefix+v+'">',r+='<a name="'+n+'" class="reference-link"><\/a>',r+='<span class="header-link octicon octicon-link"><\/span>',r+=o?this.atLink(this.emoji(h)):this.atLink(this.emoji(n)),r+("<\/h"+t+">")},f.pageBreak=function(n){return c.test(n)&&o.pageBreak&&(n='<hr style="page-break-after:always;" class="page-break editormd-page-break" />'),n},f.paragraph=function(t){var u=/\$\$(.*)\$\$/g.test(t),i=/^\$\$(.*)\$\$$/.test(t),f=i?' class="'+n.classNames.tex+'"':"",e=o.tocm?/^(\[TOC\]|\[TOCM\])$/.test(t):/^\[TOC\]$/.test(t),s=/^\[TOCM\]$/.test(t),r;return t=!i&&u?t.replace(/(\$\$([^\$]*)\$\$)+/g,function(t,i){return'<span class="'+n.classNames.tex+'">'+i.replace(/\$/g,"")+"<\/span>"}):i?t.replace(/\$/g,""):t,r='<div class="markdown-toc editormd-markdown-toc">'+t+"<\/div>",e?s?'<div class="editormd-toc-menu">'+r+"<\/div><br/>":r:c.test(t)?this.pageBreak(t):"<p"+f+">"+this.atLink(this.emoji(t))+"<\/p>\n"},f.code=function(t,i){return i==="seq"||i==="sequence"?'<div class="sequence-diagram">'+t+"<\/div>":i==="flow"?'<div class="flowchart">'+t+"<\/div>":i==="math"||i==="latex"||i==="katex"?'<p class="'+n.classNames.tex+'">'+t+"<\/p>":h.Renderer.prototype.code.apply(this,arguments)},f.tablecell=function(n,t){var i=t.header?"th":"td",r=t.align?"<"+i+' style="text-align:'+t.align+'">':"<"+i+">";return r+this.atLink(this.emoji(n))+"<\/"+i+">\n"},f.listitem=function(n){return o.taskList&&/^\s*\[[x\s]\]\s*/.test(n)?(n=n.replace(/^\s*\[\s\]\s*/,'<input type="checkbox" class="task-list-item-checkbox" /> ').replace(/^\s*\[x\]\s*/,'<input type="checkbox" class="task-list-item-checkbox" checked disabled /> '),'<li style="list-style: none;">'+this.atLink(this.emoji(n))+"<\/li>"):"<li>"+this.atLink(this.emoji(n))+"<\/li>"},f},n.markdownToCRenderer=function(n,t,i,r){var h="",s=0,c=this.classPrefix,e,a,l,u,f,o;for(r=r||1,e=0,a=n.length;e<a;e++)(l=n[e].text,u=n[e].level,u<r)||(h+=u>s?"":u<s?new Array(s-u+2).join("<\/ul><\/li>"):"<\/ul><\/li>",h+='<li><a class="toc-level-'+u+'" href="#'+l+'" level="'+u+'">'+l+"<\/a><ul>",s=u);return f=t.find(".markdown-toc"),f.length<1&&t.attr("previewContainer")==="false"&&(o='<div class="markdown-toc '+c+'markdown-toc"><\/div>',o=i?'<div class="'+c+'toc-menu">'+o+"<\/div>":o,t.html(o),f=t.find(".markdown-toc")),i&&f.wrap('<div class="'+c+'toc-menu"><\/div><br/>'),f.html('<ul class="markdown-toc-list"><\/ul>').children(".markdown-toc-list").html(h.replace(/\r?\n?\<ul\>\<\/ul\>/g,"")),f},n.tocDropdownMenu=function(n,i){i=i||"Table of Contents";var r=400,u=n.find("."+this.classPrefix+"toc-menu");return u.each(function(){var f=t(this),e=f.children(".markdown-toc"),n='<i class="fa fa-angle-down"><\/i>',s='<a href="javascript:;" class="toc-menu-btn">'+n+i+"<\/a>",u=e.children("ul"),o=u.find("li");e.append(s);o.first().before("<li><h1>"+i+" "+n+"<\/h1><\/li>");f.mouseover(function(){u.show();o.each(function(){var u=t(this),i=u.children("ul"),f;i.html()===""&&i.remove();i.length>0&&i.html()!==""&&(f=u.children("a").first(),f.children(".fa").length<1&&f.append(t(n).css({float:"right",paddingTop:"4px"})));u.mouseover(function(){i.css("z-index",r).show();r+=1}).mouseleave(function(){i.hide()})})}).mouseleave(function(){u.hide()})}),u},n.filterHTMLTags=function(n,i){var u,h,e,f;if(typeof n!="string"&&(n=new String(n)),typeof i!="string")return n;var o=i.split("|"),s=o[0].split(","),r=o[1];for(u=0,h=s.length;u<h;u++)e=s[u],n=n.replace(new RegExp("<s*"+e+"s*([^>]*)>([^>]*)<s*/"+e+"s*>","igm"),"");return typeof r!="undefined"&&(f=/\<(\w+)\s*([^\>]*)\>([^\>]*)\<\/(\w+)\>/ig,n=r==="*"?n.replace(f,function(n,t,i,r,u){return"<"+t+">"+r+"<\/"+u+">"}):r==="on*"?n.replace(f,function(n,i,r,u,f){var e=t("<"+i+">"+u+"<\/"+f+">"),h=t(n)[0].attributes,o={},s;return t.each(h,function(n,t){t.nodeName!=='"'&&(o[t.nodeName]=t.nodeValue)}),t.each(o,function(n){n.indexOf("on")===0&&delete o[n]}),e.attr(o),s=typeof e[1]!="undefined"?t(e[1]).text():"",e[0].outerHTML+s}):n.replace(f,function(n,i,u,f){var o=r.split(","),e=t(n);return e.html(f),t.each(o,function(n){e.attr(o[n],null)}),e[0].outerHTML})),n},n.markdownToHTML=function(i,r){var s,h,c;n.$marked=marked;var f=t("#"+i),u=f.settings=t.extend(!0,{gfm:!0,toc:!0,tocm:!1,tocStartLevel:1,tocTitle:"目录",tocDropdown:!1,tocContainer:"",markdown:"",markdownSourceCode:!1,htmlDecode:!1,autoLoadKaTeX:!0,pageBreak:!0,atLink:!0,emailLink:!0,tex:!1,taskList:!1,emoji:!1,flowChart:!1,sequenceDiagram:!1,previewCodeHighlight:!0},r||{}),e=f.find("textarea");e.length<1&&(f.append("<textarea><\/textarea>"),e=f.find("textarea"));var o=u.markdown===""?e.val():u.markdown,l=[],a={toc:u.toc,tocm:u.tocm,tocStartLevel:u.tocStartLevel,taskList:u.taskList,emoji:u.emoji,tex:u.tex,pageBreak:u.pageBreak,atLink:u.atLink,emailLink:u.emailLink,flowChart:u.flowChart,sequenceDiagram:u.sequenceDiagram,previewCodeHighlight:u.previewCodeHighlight},v={renderer:n.markedRenderer(l,a),gfm:u.gfm,tables:!0,breaks:!0,pedantic:!1,sanitize:u.htmlDecode?!1:!0,smartLists:!0,smartypants:!0};return o=new String(o),s=marked(o,v),s=n.filterHTMLTags(s,u.htmlDecode),u.markdownSourceCode?e.text(o):e.remove(),f.addClass("markdown-body "+this.classPrefix+"html-preview").append(s),h=u.tocContainer!==""?t(u.tocContainer):f,u.tocContainer!==""&&h.attr("previewContainer",!1),u.toc&&(f.tocContainer=this.markdownToCRenderer(l,h,u.tocDropdown,u.tocStartLevel),(u.tocDropdown||f.find("."+this.classPrefix+"toc-menu").length>0)&&this.tocDropdownMenu(f,u.tocTitle),u.tocContainer!==""&&f.find(".editormd-toc-menu, .editormd-markdown-toc").remove()),u.previewCodeHighlight&&(f.find("pre").addClass("prettyprint linenums"),prettyPrint()),n.isIE8||(u.flowChart&&f.find(".flowchart").flowChart(),u.sequenceDiagram&&f.find(".sequence-diagram").sequenceDiagram({theme:"simple"})),u.tex&&(c=function(){f.find("."+n.classNames.tex).each(function(){var n=t(this);katex.render(n.html().replace(/&lt;/g,"<").replace(/&gt;/g,">"),n[0]);n.find(".katex").css("font-size","1.6em")})},!u.autoLoadKaTeX||n.$katex||n.kaTeXLoaded?c():this.loadKaTeX(function(){n.$katex=katex;n.kaTeXLoaded=!0;c()})),f.getMarkdown=function(){return e.val()},f},n.themes=["default","dark"],n.previewThemes=["default","dark"],n.editorThemes=["default","3024-day","3024-night","ambiance","ambiance-mobile","base16-dark","base16-light","blackboard","cobalt","eclipse","elegant","erlang-dark","lesser-dark","mbo","mdn-like","midnight","monokai","neat","neo","night","paraiso-dark","paraiso-light","pastel-on-dark","rubyblue","solarized","the-matrix","tomorrow-night-eighties","twilight","vibrant-ink","xq-dark","xq-light"],n.loadPlugins={},n.loadFiles={js:[],css:[],plugin:[]},n.loadPlugin=function(t,i,r){i=i||function(){};this.loadScript(t,function(){n.loadFiles.plugin.push(t);i()},r)},n.loadCSS=function(t,i,r){r=r||"head";i=i||function(){};var u=document.createElement("link");u.type="text/css";u.rel="stylesheet";u.onload=u.onreadystatechange=function(){n.loadFiles.css.push(t);i()};u.href=t+".css";r==="head"?document.getElementsByTagName("head")[0].appendChild(u):document.body.appendChild(u)},n.isIE=navigator.appName=="Microsoft Internet Explorer",n.isIE8=n.isIE&&navigator.appVersion.match(/8./i)=="8.",n.loadScript=function(t,i,r){r=r||"head";i=i||function(){};var u=null;u=document.createElement("script");u.id=t.replace(/[\./]+/g,"-");u.type="text/javascript";u.src=t+".js";n.isIE8?u.onreadystatechange=function(){u.readyState&&(u.readyState==="loaded"||u.readyState==="complete")&&(u.onreadystatechange=null,n.loadFiles.js.push(t),i())}:u.onload=function(){n.loadFiles.js.push(t);i()};r==="head"?document.getElementsByTagName("head")[0].appendChild(u):document.body.appendChild(u)},n.katexURL={css:"//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min",js:"//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min"},n.kaTeXLoaded=!1,n.loadKaTeX=function(t){n.loadCSS(n.katexURL.css,function(){n.loadScript(n.katexURL.js,t||function(){})})},n.lockScreen=function(n){t("html,body").css("overflow",n?"hidden":"")},n.createDialog=function(i){var r,c,l,a,e,v,p,w,o;i=t.extend(!0,{name:"",width:420,height:240,title:"",drag:!0,closed:!0,content:"",mask:!0,maskStyle:{backgroundColor:"#fff",opacity:.1},lockScreen:!0,footer:!0,buttons:!1},i);var d=this,s=this.editor,u=n.classPrefix,g=(new Date).getTime(),y=i.name===""?u+"dialog-"+g:i.name,h=n.mouseOrTouch,f='<div class="'+u+"dialog "+y+'">';if(i.title!==""&&(f+='<div class="'+u+'dialog-header"'+(i.drag?' style="cursor: move;"':"")+">",f+='<strong class="'+u+'dialog-title">'+i.title+"<\/strong>",f+="<\/div>"),i.closed&&(f+='<a href="javascript:;" class="fa fa-close '+u+'dialog-close"><\/a>'),f+='<div class="'+u+'dialog-container">'+i.content,(i.footer||typeof i.footer=="string")&&(f+='<div class="'+u+'dialog-footer">'+(typeof i.footer=="boolean"?"":i.footer)+"<\/div>"),f+="<\/div>",f+='<div class="'+u+"dialog-mask "+u+'dialog-mask-bg"><\/div>',f+='<div class="'+u+"dialog-mask "+u+'dialog-mask-con"><\/div>',f+="<\/div>",s.append(f),r=s.find("."+y),r.lockScreen=function(n){return i.lockScreen&&(t("html,body").css("overflow",n?"hidden":""),d.resize()),r},r.showMask=function(){return i.mask&&s.find("."+u+"mask").css(i.maskStyle).css("z-index",n.dialogZindex-1).show(),r},r.hideMask=function(){return i.mask&&s.find("."+u+"mask").hide(),r},r.loading=function(n){var t=r.find("."+u+"dialog-mask");return t[n?"show":"hide"](),r},r.lockScreen(!0).showMask(),r.show().css({zIndex:n.dialogZindex,border:n.isIE8?"1px solid #ddd":"",width:typeof i.width=="number"?i.width+"px":i.width,height:typeof i.height=="number"?i.height+"px":i.height}),c=function(){r.css({top:(t(window).height()-r.height())/2+"px",left:(t(window).width()-r.width())/2+"px"})},c(),t(window).resize(c),r.children("."+u+"dialog-close").bind(h("click","touchend"),function(){r.hide().lockScreen(!1).hideMask()}),typeof i.buttons=="object"){l=r.footer=r.find("."+u+"dialog-footer");for(a in i.buttons)e=i.buttons[a],v=u+a+"-btn",l.append('<button class="'+u+"btn "+v+'">'+e[0]+"<\/button>"),e[1]=t.proxy(e[1],r),l.children("."+v).bind(h("click","touchend"),e[1])}if(i.title!==""&&i.drag){o=r.children("."+u+"dialog-header");i.mask||o.bind(h("click","touchend"),function(){n.dialogZindex+=2;r.css("z-index",n.dialogZindex)});o.mousedown(function(n){n=n||window.event;p=n.clientX-parseInt(r[0].style.left);w=n.clientY-parseInt(r[0].style.top);document.onmousemove=nt});var b=function(n){n.removeClass(u+"user-unselect").off("selectstart")},k=function(n){n.addClass(u+"user-unselect").on("selectstart",function(){return!1})},nt=function(n){n=n||window.event;var i,u,f=parseInt(r[0].style.left),e=parseInt(r[0].style.top);f>=0?f+r.width()<=t(window).width()?i=n.clientX-p:(i=t(window).width()-r.width(),document.onmousemove=null):(i=0,document.onmousemove=null);e>=0?u=n.clientY-w:(u=0,document.onmousemove=null);document.onselectstart=function(){return!1};k(t("body"));k(r);r[0].style.left=i+"px";r[0].style.top=u+"px"};document.onmouseup=function(){b(t("body"));b(r);document.onselectstart=null;document.onmousemove=null};o.touchDraggable=function(){var n=null,i=function(i){var r=i.originalEvent,u=t(this).parent().position();n={x:r.changedTouches[0].pageX-u.left,y:r.changedTouches[0].pageY-u.top}},r=function(i){i.preventDefault();var r=i.originalEvent;t(this).parent().css({top:r.changedTouches[0].pageY-n.y,left:r.changedTouches[0].pageX-n.x})};this.bind("touchstart",i).bind("touchmove",r)};o.touchDraggable()}return n.dialogZindex+=2,r},n.mouseOrTouch=function(n,t){n=n||"click";t=t||"touchend";var i=n;try{document.createEvent("TouchEvent");i=t}catch(r){}return i},n.dateFormat=function(n){var p,w;n=n||"";var r=function(n){return n<10?"0"+n:n},i=new Date,u=i.getFullYear(),s=u.toString().slice(2,4),f=r(i.getMonth()+1),e=r(i.getDate()),h=i.getDay(),c=r(i.getHours()),l=r(i.getMinutes()),a=r(i.getSeconds()),v=r(i.getMilliseconds()),t="",b=s+"-"+f+"-"+e,o=u+"-"+f+"-"+e,y=c+":"+l+":"+a;switch(n){case"UNIX Time":t=i.getTime();break;case"UTC":t=i.toUTCString();break;case"yy":t=s;break;case"year":case"yyyy":t=u;break;case"month":case"mm":t=f;break;case"cn-week-day":case"cn-wd":p=["日","一","二","三","四","五","六"];t="星期"+p[h];break;case"week-day":case"wd":w=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];t=w[h];break;case"day":case"dd":t=e;break;case"hour":case"hh":t=c;break;case"min":case"ii":t=l;break;case"second":case"ss":t=a;break;case"ms":t=v;break;case"yy-mm-dd":t=b;break;case"yyyy-mm-dd":t=o;break;case"yyyy-mm-dd h:i:s ms":case"full + ms":t=o+" "+y+" "+v;break;case"full":case"yyyy-mm-dd h:i:s":default:t=o+" "+y}return t},n});